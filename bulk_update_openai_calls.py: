import os

ROOT_DIR = os.getcwd()

for subdir, _, files in os.walk(ROOT_DIR):
    for file in files:
        if file.endswith(".py"):
            file_path = os.path.join(subdir, file)

            with open(file_path, "r", encoding="utf-8") as f:
                content = f.read()

            original_content = content

            if "import openai" in content:
                content = content.replace(
                    "import openai",
                    "from imi_macro_updater.run_update import tracked_chat_completion"
                )

            if "openai.ChatCompletion.create" in content:
                content = content.replace(
                    "openai.ChatCompletion.create",
                    "tracked_chat_completion"
                )

            if content != original_content:
                with open(file_path, "w", encoding="utf-8") as f:
                    f.write(content)
                print(f"Updated: {file_path}")

print("âœ… All modules updated to use tracked_chat_completion.")
